<script>
  const BACKEND_URL = "https://YOUR-RENDER-SERVICE.onrender.com/run-intelligence";
  // Example: "https://industrial-gc-intelligence.onrender.com/run-intelligence"

  async function runEngine() {
    const status = document.getElementById("status");
    const output = document.getElementById("output");

    status.innerText = "Generating report...";
    output.innerHTML = "";

    try {
      const res = await fetch(BACKEND_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          prompt: "RUN_MOCK" 
          // If your backend expects the full master prompt, replace RUN_MOCK with that string
        })
      });

      const text = await res.text();

      // If backend returned non-JSON (like an error page), show it
      if (!res.ok) {
        status.innerText = `DONE ✅ HTTP ${res.status}`;
        output.innerText = text;
        return;
      }

      // Parse JSON safely
      let data;
      try {
        data = JSON.parse(text);
      } catch (e) {
        status.innerText = "DONE ✅ (but response was not JSON)";
        output.innerText = <div id="output" style="background:#f2f2f2; padding:12px;"></div>
        return;
      }

      // Render clean report
      let html = `<h2>DAILY OPPORTUNITY REPORT — ${data.date || ""}</h2>`;

      (data.opportunities || []).forEach((item, index) => {
        html += `
          <div style="border:1px solid #ccc; padding:15px; margin:10px 0; border-radius:10px;">
            <h3>${index + 1}. ${item.project || ""}</h3>
            <p><strong>Company:</strong> ${item.company || ""}</p>
            <p><strong>Estimated Value:</strong> ${item.value || ""}</p>
            <p><strong>Location:</strong> ${item.location || ""}</p>
            <p><strong>Signal Type:</strong> ${item.signal || ""}</p>
            <p><strong>Why High Probability:</strong> ${item.probability || ""}</p>
            <p><strong>Suggested Outreach:</strong> ${item.outreach || ""}</p>
          </div>
        `;
      });

      html += `<h3>Strategic Insights Today</h3><ul>`;
      (data.strategicInsights || []).forEach(i => html += `<li>${i}</li>`);
      html += `</ul>`;

      html += `<h3>Improvement Signals</h3><ul>`;
      (data.improvements || []).forEach(i => html += `<li>${i}</li>`);
      html += `</ul>`;

      status.innerText = `DONE ✅ HTTP ${res.status}`;
      output.innerHTML = html;

    } catch (err) {
      status.innerText = "FAILED ❌";
      output.innerText = err.message;
    }
  }
</script>
