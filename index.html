<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Industrial GC Intelligence</title>
  <style>
    :root{
      --bg: #0b1220;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.08);
      --line: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --muted2: rgba(255,255,255,.45);
      --accent: #6ee7ff;
      --accent2:#60a5fa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 12px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color:var(--text);
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(110,231,255,.14), transparent 60%),
        radial-gradient(900px 500px at 75% 0%, rgba(96,165,250,.16), transparent 60%),
        radial-gradient(800px 500px at 50% 90%, rgba(167,139,250,.10), transparent 60%),
        var(--bg);
    }

    a{ color:inherit; }

    .wrap{ max-width: 1180px; margin: 0 auto; padding: 22px 18px 40px; }

    /* Top bar */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px;
      padding: 14px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      min-width: 260px;
    }
    .logo{
      width:38px; height:38px; border-radius: 12px;
      background: linear-gradient(135deg, rgba(110,231,255,.9), rgba(96,165,250,.9));
      box-shadow: 0 10px 30px rgba(96,165,250,.25);
      position:relative;
    }
    .logo:after{
      content:""; position:absolute; inset:9px;
      border-radius:10px;
      background: rgba(11,18,32,.55);
      border:1px solid rgba(255,255,255,.18);
    }
    .brand h1{
      margin:0; font-size: 15px; letter-spacing: .2px;
      line-height:1.1;
    }
    .brand .sub{
      margin:2px 0 0; font-size: 12px; color: var(--muted2);
    }

    .actions{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px; border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 12px;
      user-select:none;
    }
    .dot{ width:8px; height:8px; border-radius: 99px; background: var(--good); box-shadow:0 0 0 3px rgba(52,211,153,.12); }

    .btn{
      border:0;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 650;
      letter-spacing:.2px;
      cursor:pointer;
      color: rgba(11,18,32,.95);
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 12px 26px rgba(96,165,250,.18);
      transition: transform .08s ease, filter .12s ease, opacity .12s ease;
      display:inline-flex; align-items:center; gap:10px;
    }
    .btn:active{ transform: translateY(1px); }
    .btn[disabled]{ opacity:.55; cursor:not-allowed; }
    .btn.secondary{
      color: var(--text);
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      box-shadow:none;
    }
    .btn .spark{
      width:10px; height:10px; border-radius:999px;
      background: rgba(11,18,32,.55);
      border:1px solid rgba(255,255,255,.25);
    }

    /* Layout */
    .grid{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 16px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .brand{ min-width:auto; }
    }

    .card{
      background: rgba(255,255,255,.05);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .card .hd{
      padding: 14px 16px;
      border-bottom: 1px solid var(--line);
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .card .hd h2{ margin:0; font-size: 14px; letter-spacing:.2px; }
    .card .hd p{ margin:6px 0 0; color: var(--muted2); font-size: 12px; line-height:1.3; }
    .card .bd{ padding: 16px; }

    /* KPI tiles */
    .kpis{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
    @media (max-width: 520px){ .kpis{ grid-template-columns: 1fr; } }

    .kpi{
      padding: 14px;
      border-radius: var(--radius2);
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      position:relative;
      overflow:hidden;
    }
    .kpi:before{
      content:"";
      position:absolute; inset:-80px -80px auto auto;
      width:180px; height:180px;
      background: radial-gradient(circle at 30% 30%, rgba(110,231,255,.20), transparent 55%);
      transform: rotate(12deg);
    }
    .kpi .label{ color: var(--muted2); font-size: 12px; }
    .kpi .value{ margin-top: 6px; font-size: 20px; font-weight: 800; letter-spacing:.3px; }
    .kpi .hint{ margin-top: 4px; color: var(--muted2); font-size: 12px; }

    /* Output */
    .statusRow{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .status{
      display:inline-flex; align-items:center; gap:10px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size:12px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding: 6px 10px; border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      font-size:12px; color: var(--muted);
    }
    .badge.good{ color: rgba(52,211,153,.95); border-color: rgba(52,211,153,.25); background: rgba(52,211,153,.10); }
    .badge.bad{ color: rgba(251,113,133,.95); border-color: rgba(251,113,133,.25); background: rgba(251,113,133,.10); }

    .divider{ height:1px; background: var(--line); margin: 14px 0; }

    .reportTitle{
      display:flex; align-items:flex-end; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .reportTitle h3{ margin:0; font-size: 18px; letter-spacing:.2px; }
    .reportTitle .date{ color: var(--muted2); font-size: 12px; }

    .sectionTitle{ margin: 14px 0 8px; font-size: 13px; color: var(--muted); font-weight: 700; letter-spacing:.2px; text-transform: uppercase; }

    .list{ margin:0; padding-left: 18px; color: var(--text); }
    .list li{ margin: 7px 0; color: var(--muted); line-height:1.45; }
    .list li strong{ color: var(--text); }

    .opps{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    @media (max-width: 720px){ .opps{ grid-template-columns: 1fr; } }

    .opp{
      border-radius: var(--radius2);
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      padding: 14px;
    }
    .oppTop{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .opp h4{ margin:0; font-size: 14px; letter-spacing:.2px; }
    .pill2{
      display:inline-flex; align-items:center;
      padding: 6px 10px; border-radius:999px;
      font-size: 11px; font-weight: 700;
      color: rgba(11,18,32,.92);
      background: linear-gradient(135deg, rgba(110,231,255,.95), rgba(96,165,250,.95));
    }
    .meta{ margin-top: 8px; color: var(--muted2); font-size: 12px; line-height:1.45; }
    .kv{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap: 8px 12px;
      margin-top: 10px;
      font-size: 12px;
    }
    .k{ color: var(--muted2); }
    .v{ color: var(--muted); }

    .monoBox{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.75);
      background: rgba(255,255,255,.03);
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      padding: 12px;
      white-space: pre-wrap;
      overflow:auto;
      max-height: 320px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Industrial GC Intelligence</h1>
          <div class="sub">Early project signals • clean executive brief</div>
        </div>
      </div>

      <div class="actions">
        <div class="pill"><span class="dot"></span><span>Service status: <span id="svcStatus">Ready</span></span></div>
        <button class="btn secondary" id="clearBtn" type="button">Clear</button>
        <button class="btn" id="runBtn" type="button"><span class="spark"></span>Run Engine</button>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: OUTPUT -->
      <div class="card">
        <div class="hd">
          <div>
            <h2>Executive Opportunity Brief</h2>
            <p>Generates high-signal opportunities and recommended outreach for near-term pursuit.</p>
          </div>
          <div class="statusRow">
            <span class="status" id="statusText">Idle</span>
            <span class="badge" id="httpBadge">HTTP —</span>
          </div>
        </div>

        <div class="bd" id="output">
          <div class="reportTitle">
            <h3>Waiting for run…</h3>
            <div class="date">Press “Run Engine” to generate a report</div>
          </div>

          <div class="divider"></div>

          <div class="monoBox" id="rawBox" style="display:none;"></div>

          <div class="kpis" id="kpis" style="display:none;">
            <div class="kpi">
              <div class="label">Opportunities returned</div>
              <div class="value" id="kpiOpps">—</div>
              <div class="hint">Total items in today’s brief</div>
            </div>
            <div class="kpi">
              <div class="label">Top shown</div>
              <div class="value" id="kpiTop">—</div>
              <div class="hint">Cards displayed below</div>
            </div>
            <div class="kpi">
              <div class="label">Status</div>
              <div class="value" id="kpiStatus">—</div>
              <div class="hint">Request result</div>
            </div>
          </div>

          <div id="reportArea" style="display:none;"></div>
        </div>
      </div>

      <!-- RIGHT: CONTROLS / NOTES -->
      <div class="card">
        <div class="hd">
          <div>
            <h2>Run Settings</h2>
            <p>Use mock mode for demos. Switch to live backend when ready.</p>
          </div>
        </div>
        <div class="bd">
          <div class="sectionTitle">Mode</div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn secondary" id="mockBtn" type="button">Use MOCK</button>
            <button class="btn secondary" id="liveBtn" type="button">Use LIVE</button>
          </div>

          <div class="divider"></div>

          <div class="sectionTitle">Backend URL</div>
          <div class="monoBox" style="max-height:none;" id="backendPreview"></div>

          <div class="divider"></div>

          <div class="sectionTitle">Tip</div>
          <ul class="list">
            <li><strong>Netlify frontend</strong> should call your <strong>Render backend</strong> endpoint ending with <strong>/run-intelligence</strong>.</li>
            <li>If you see <strong>HTTP 500</strong>, check Render logs (often API key / quota / route mismatch).</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

<script>
  // ✅https://industrial-gc-intelligence.onrender.com CHANGE ONLY THIS:
  const LIVE_BACKEND_URL = "https://industrial-gc-intelligence.onrender.com/run-intelligence";

  // If you don't have live working, keep mock mode on.
  let BACKEND_URL = LIVE_BACKEND_URL;
  let MODE = "LIVE"; // "MOCK" or "LIVE"

  const runBtn = document.getElementById("runBtn");
  const clearBtn = document.getElementById("clearBtn");
  const mockBtn = document.getElementById("mockBtn");
  const liveBtn = document.getElementById("liveBtn");

  const svcStatus = document.getElementById("svcStatus");
  const statusText = document.getElementById("statusText");
  const httpBadge = document.getElementById("httpBadge");

  const backendPreview = document.getElementById("backendPreview");
  const rawBox = document.getElementById("rawBox");

  const kpis = document.getElementById("kpis");
  const kpiOpps = document.getElementById("kpiOpps");
  const kpiTop = document.getElementById("kpiTop");
  const kpiStatus = document.getElementById("kpiStatus");
  const reportArea = document.getElementById("reportArea");

  function setMode(next){
    MODE = next;
    if (MODE === "MOCK"){
      // Your backend still gets called, but we send RUN_MOCK so it returns demo JSON.
      svcStatus.textContent = "Mock";
    } else {
      svcStatus.textContent = "Live";
    }
    backendPreview.textContent = BACKEND_URL;
  }

  function escapeHtml(str){
    return String(str ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function setHttpBadge(code, ok){
    httpBadge.textContent = `HTTP ${code}`;
    httpBadge.className = "badge " + (ok ? "good" : "bad");
  }

  function clearOutput(){
    statusText.textContent = "Idle";
    httpBadge.textContent = "HTTP —";
    httpBadge.className = "badge";
    rawBox.style.display = "none";
    rawBox.textContent = "";

    kpis.style.display = "none";
    reportArea.style.display = "none";
    reportArea.innerHTML = "";

    document.querySelector("#output .reportTitle h3").textContent = "Waiting for run…";
    document.querySelector("#output .reportTitle .date").textContent = "Press “Run Engine” to generate a report";
  }

  function renderReport(data){
    const date = data?.date ? escapeHtml(data.date) : escapeHtml(new Date().toISOString().slice(0,10));
    const ops = Array.isArray(data?.opportunities) ? data.opportunities : [];
    const insights = Array.isArray(data?.strategicInsights) ? data.strategicInsights : [];
    const improvements = Array.isArray(data?.improvements) ? data.improvements : [];

    const top = ops.slice(0, 3);

    // KPIs
    kpis.style.display = "grid";
    kpiOpps.textContent = ops.length;
    kpiTop.textContent = Math.min(3, ops.length);
    kpiStatus.textContent = "Complete";

    // Header text
    document.querySelector("#output .reportTitle h3").textContent = "Executive Opportunity Brief";
    document.querySelector("#output .reportTitle .date").textContent = date;

    // Sections
    const insightHtml = insights.length
      ? `<ul class="list">${insights.slice(0,6).map(x => `<li>${escapeHtml(x)}</li>`).join("")}</ul>`
      : `<div class="monoBox" style="max-height:none;">No strategic insights returned.</div>`;

    const improvementHtml = improvements.length
      ? `<ul class="list">${improvements.slice(0,6).map(x => `<li>${escapeHtml(x)}</li>`).join("")}</ul>`
      : `<div class="monoBox" style="max-height:none;">No improvement signals returned.</div>`;

    const oppCards = top.length
      ? `<div class="opps">${top.map((item) => {
          const project = escapeHtml(item.project || "Untitled Opportunity");
          const company = escapeHtml(item.company || "Unknown Company");
          const location = escapeHtml(item.location || "—");
          const value = escapeHtml(item.value || "—");
          const signal = escapeHtml(item.signal || "Signal");
          const probability = escapeHtml(item.probability || "—");
          const outreach = escapeHtml(item.outreach || "—");

          return `
            <div class="opp">
              <div class="oppTop">
                <h4>${project}</h4>
                <span class="pill2">${signal}</span>
              </div>
              <div class="meta">${company} • ${location} • <strong style="color:var(--text)">${value}</strong></div>

              <div class="kv">
                <div class="k">Probability signal</div><div class="v">${probability}</div>
                <div class="k">Recommended outreach</div><div class="v">${outreach}</div>
              </div>
            </div>
          `;
        }).join("")}</div>`
      : `<div class="monoBox" style="max-height:none;">No opportunities returned.</div>`;

    reportArea.style.display = "block";
    reportArea.innerHTML = `
      <div class="divider"></div>

      <div class="sectionTitle">Strategic Insights</div>
      ${insightHtml}

      <div class="sectionTitle">Improvement Signals</div>
      ${improvementHtml}

      <div class="sectionTitle">Top Opportunities</div>
      ${oppCards}

      ${ops.length > 3 ? `<div class="divider"></div><div style="color:var(--muted2); font-size:12px;">Showing top 3 of ${ops.length}. (You can add paging later.)</div>` : ""}
    `;
  }

  async function runEngine(){
    runBtn.disabled = true;
    statusText.textContent = "Generating…";
    httpBadge.textContent = "HTTP —";
    httpBadge.className = "badge";
    rawBox.style.display = "none";
    reportArea.style.display = "none";
    kpis.style.display = "none";

    try{
      const res = await fetch(BACKEND_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          // Your backend can read this however you coded it:
          prompt: MODE === "MOCK" ? "RUN_MOCK" : "RUN_LIVE"
        })
      });

      const text = await res.text();
      setHttpBadge(res.status, res.ok);

      // If backend returns non-200, show raw so you can debug
      if (!res.ok){
        statusText.textContent = "Failed";
        kpis.style.display = "grid";
        kpiOpps.textContent = "—";
        kpiTop.textContent = "—";
        kpiStatus.textContent = "Error";

        rawBox.style.display = "block";
        rawBox.textContent = text || "(empty response)";
        return;
      }

      // Try JSON parse
      let data;
      try{
        data = JSON.parse(text);
      } catch (e){
        statusText.textContent = "Complete (non-JSON)";
        rawBox.style.display = "block";
        rawBox.textContent = text;
        return;
      }

      statusText.textContent = "Complete";
      renderReport(data);

    } catch(err){
      setHttpBadge("—", false);
      statusText.textContent = "Request error";

      rawBox.style.display = "block";
      rawBox.textContent = err?.message || String(err);

      kpis.style.display = "grid";
      kpiOpps.textContent = "—";
      kpiTop.textContent = "—";
      kpiStatus.textContent = "Error";
    } finally {
      runBtn.disabled = false;
    }
  }

  // Buttons
  runBtn.addEventListener("click", runEngine);
  clearBtn.addEventListener("click", clearOutput);
  mockBtn.addEventListener("click", () => setMode("MOCK"));
  liveBtn.addEventListener("click", () => setMode("LIVE"));

  // Init
  backendPreview.textContent = BACKEND_URL;
  setMode("LIVE");
</script>
</body>
</html>
